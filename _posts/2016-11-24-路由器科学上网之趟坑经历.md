---
id: 983
title: 路由器科学上网之趟坑经历
date: 2016-11-24T11:06:42+08:00
author: cloud
layout: post
guid: http://www.cloudchou.com/?p=983
permalink: /android/post-983.html
published: false
categories:
  - work
tags:
  - work
---


## 背景


## 遇到的那些问题

1.  选择兼容的openwrt版本,shadowsocks版本,luci-app-shadowsocks版本，chinadns版本, luci-app-chinadns版本

遇到的问题:
    
    低版本的openwrt 安装 shadowsocks 遇到的问题: postinst script returned status 127 
    prerm script returned status 127 
    因为/lib/functions.sh缺少这两个函数 postinst prerm

    openwrt升级到snapshot版本后 找不到libUclib.so，导致无法启动chinadns，报错 ash chinadns  not found
    或者 ash shadowsocks  not found

    openwrt 需要使用稳定版

    要想在网页上 配置 shadowsocks， 必须安装luci-app-shadowsocks, 但是还需要选择正确的shadowsocks版本，
    必须使用spec版本，才会携带/etc/init.d/shadowsocks脚本，也才能与luci-app-shadowsocks兼容 


    因为shadowsocks没有开启fastopen, getpeername transport endpoint is not connected
    若要开启fastopen，要求linux内核必须是3.7.0以上
    所以给VPS重装系统

    VPS只让安装CENTOS 6.4， 然后升级到6.8
    ```bash
    yum update
    ```
    
    升级内核至3.10
    ```bash
    #导入 Public Key
    rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org
    #安装 ELRepo
    rpm -Uvh http://www.elrepo.org/elrepo-release-6-6.el6.elrepo.noarch.rpm
    #升级 Kernel
    yum --enablerepo=elrepo-kernel install kernel-lt -y
    #更新grub
    vi /etc/grub.conf
    #根据安装好以后的内核位置，修改 default 的值，一般是修改为0，因为 default 从 0 开始，一般新安装的内核在第一个位置，所以设置default=0
    #所有操作都执行完毕以后，重启主机，重启后执行 uname -r，查看内核版本号，判断是否升级成功
    ```



    再安装Shadowsocks



## 参考资料

[使用Yum快速更新升级CentOS内核](https://www.sjy.im/toss/use-yum-update-centos-kernel-quickly.html)    
[Shadowsocks + ChnRoute 实现 OpenWRT 路由器自动翻墙](https://cokebar.info/archives/664)
[CentOS下shadowsocks-libev一键安装脚本](https://teddysun.com/357.html)