---
id: 1001
title: 前端代码格式化配置
date: 2018-07-16T20:29:50+08:00
author: cloud
layout: post
guid: http://www.cloudchou.com/?p=1001
permalink: /web/post-1001.html
published: false
categories:
- web
tags:
- web
---

目前前端项目主要编程语言: html + scss(css,) + vue + javascript + typesccript

经调研最适合的代码格式化方案是:

```
tslint + eslint + prettier + js-beautify-html
```

其中tslint和eslint是类似的，都是检查代码中的风格错误，并提示，tslint针对typescript，而eslint针对JavaScript

而js-beautify-html主要是针对vue文件中的template部分，VSCode的vetur插件格式化template部分的代码时使用的就是js-beautify-html工具，而vetur插件官方说js-beautify-html并不怎么好，在考虑替换它为其它工具，但是目前还没有更好的选择

格式化代码主要功臣还是eslint+prettier或者tslint+prettier

## eslint + prettier 工作原理

eslint本身有格式化代码的能力，但它还能提示风格错误，而prettier只能做代码格式化，我们很容易遇到这样的情况:

`使用prettier格式化代码后， eslint检测出代码风格有问题，然后提示一堆告警`

为了解决上述问题，我们需要引入eslint的1个配置扩展和1个插件(它们都是npm包，可通过npm安装):

1.  配置扩展: eslint-config-prettier

    在这个扩展里，关闭了eslint和prettier格式化冲突相关的所有rules，所以我们在eslint配置文件`eslintrc.js`中可以这样配置:

    ```
    {
        "extends": [
            "prettier"
        ]
    }
    ```

2.  插件: eslint-plugin-prettier

    eslint使用这个插件来调用prettier对代码进行格式化，但是我们还是需要安装额外的`prettier`npm包，使用这个插件时，需要在eslint配置文件`eslintrc.js`中这样修改:

    ```
    {
        "plugins": [
            "prettier"
        ],
        "rules": {
            "prettier/prettier": "error"
        }
    }
    ```
    
    同时这个插件也能提供风格相关检查的配置，不过它依赖于上一个配置扩展: eslint-config-prettier，我们可以再修改配置文件`eslintrc.js`:

    ```
    {
        "extends": [
            "plugin:prettier/recommended"
        ],
        "plugins": [
            "prettier"
        ],
        "rules": {
            "prettier/prettier": "error"
        }
    }
    ```

如果我们直接使用配置文件.prettierrc为prettier提供代码格式化参数，那么vscode的插件prettier-vscode确实会使用这个文件来格式化代码，但是eslint却不会读取这个配置文件来调用prettier，我们只能在修改配置文件`eslintrc.js`中修改prettier的格式化参数，像下面这样:

```
rules: {
    // 自定义 prettier 规则 (实际上，可配置项非常有限)
    'prettier/prettier': [
      'error',
      {
        singleQuote: true,
        trailingComma: 'all',
      },
    ],
  },
```

## eslint + prettier 最佳实践

### VSCode 配置

1.  安装插件

    * ESLint
    * Prettier

2.  修改项目settings.json配置

    ```
    "eslint.validate": [
        "javascript",
        {
        "language": "vue",
        "autoFix": true
        },
        {
        "language": "html",
        "autoFix": true
        }
    ],
   
    "prettier.eslintIntegration": true,
    "eslint.autoFixOnSave": true,
    "editor.formatOnSave": true
    "vetur.format.defaultFormatter.html": "js-beautify-html",
    "vetur.format.defaultFormatterOptions": {
        "js-beautify-html": {
        "indent_size": 2 // Indentation size
        }
    }
    ```

### 安装相关npm包     

1. `ESlint`相关npm包

```
cnpm install -D eslint babel-core babel-eslint eslint-plugin-html eslint-plugin-vue 
```

2. `Prettier`相关npm包

```
cnpm install -D  eslint-config-prettier eslint-plugin-prettier prettier prettier-eslint-cli
```

### 修改 ESlint 配置文件 .eslintrc.js 配置

```javascript
module.exports = {
  root: true,
  parserOptions: {
    // 检查 ES6 语法
    parser: 'babel-eslint',
  },
  env: {
    browser: true,
  },
  // extending airbnb config and config derived from eslint-config-prettier
  // 这里是 vue
  extends: ['plugin:vue/essential', "plugin:prettier/recommended"],

  // 选择 eslint 插件
  plugins: ['prettier', 'vue'],

  // 自定义 eslint 检查规则
  rules: {
    // 自定义 prettier 规则 (实际上，可配置项非常有限)
    'prettier/prettier': [
      'error',
      {
        singleQuote: true,
        trailingComma: 'all',
      },
    ],
    'camelcase': 'off', // 强制驼峰法命名
    'no-new': 'off', // 禁止在使用new构造一个实例后不赋值
    'space-before-function-paren': 'off', // 函数定义时括号前面不要有空格
    'no-plusplus': 'off', // 禁止使用 ++， ——
    'max-len': 'off', // 字符串最大长度
    'func-names': 'off', // 函数表达式必须有名字
    'no-param-reassign': 'off', // 不准给函数入参赋值
  },
};
```

### 配置npm命令，格式化代码

```
{
  "scripts": {
    "eslint-fix": "eslint src/**/**/*.vue  src/**/**/*.js src/**/**/*.scss src/**/**/*.css --fix",
    "format-code": "prettier-eslint --write \"src/**/*.js\" \"src/**/*.vue\" \"src/**/*.scss\" \"src/**/*.css\" "
  }
}
```

## tslint + prettier 工作原理

`tslint + prettier`的工作原理 和 `eslint + prettier`的工作原理类似，但是tslint不可以格式化，只能使用prettier格式化, 使用prettier格式化时也很容易和tslint的代码风格冲突，所以为了解决这个问题，我们需要安装tslint的配置扩展包`tslint-config-prettier`，并且修改`tslint.json`配置文件如下所示:

```
{
  "extend": ["tslint:recommended", "tslint-config-prettier"],
}
```

## tslint + prettier 最佳实践

### VSCode 配置

1.  安装插件
 
    * Prettier
    * tslint

2.  修改项目settings.json配置

    ```
    "prettier.eslintIntegration": true,
    "eslint.autoFixOnSave": true,
    "editor.formatOnSave": true
    "vetur.format.defaultFormatter.html": "js-beautify-html",
    "vetur.format.defaultFormatterOptions": {
        "js-beautify-html": {
        "indent_size": 2 // Indentation size
        }
    }
    ```

### 安装相关npm包     


1. `tslint`相关npm包

```
cnpm install -D tslint t
```

2. `Prettier`相关npm包

```
cnpm install -D  slint-config-prettier prettier prettier-tslint-cli
```

3. `scss`相关npm包

```
cnpm install -D stylelint prettier-stylelint
```

### 修改 tslint 配置文件 tslint.json 配置

```
{
  "extend": ["tslint:recommended", "tslint-config-prettier"],
}
```

### 修改 prettier配置

```
{
    "eslintIntegration": true,
    "stylelintIntegration": true,
    "tabWidth": 2,
    "singleQuote": true,
    "semi": false
}
```

### 添加stylint配置文件

```
module.exports = {
    extends: [
        './node_modules/prettier-stylelint/config.js'
    ],
    rules: {
        'string-quotes': 'double'
    }
};
```

### 配置npm命令，格式化代码

```
{
  "scripts": {
    "tslint-fix": "tslint src/**/**/*.vue  src/**/**/*.js src/**/**/*.scss src/**/**/*.css --fix",
    "format-code": "prettier-tslint --write \"src/**/*.js\" \"src/**/*.vue\" \"src/**/*.scss\" \"src/**/*.css\" "
  }
}
```

## 参考材料

1. [使用 ESLint && Prettier 规范代码格式](https://xiaogliu.github.io/2018/05/15/format-code-by-eslint-and-prettier/)
2. [使用ESLint ＆ Prettier美化Vue代码](https://jeffjade.com/2018/06/18/142-beautify-vue-by-eslint-and-prettier/)